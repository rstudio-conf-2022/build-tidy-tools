---
title: "üì¶ <br>Building tidy tools"
subtitle: "Day 1 Session 4: Documentation - Sharing"
author: "Emma Rand and Ian Lyttle"
date: "<br>üîó [rstd.io/btt](https://rstd.io/btt)"
format:
  revealjs: 
    theme: [simple, emma.scss]
    slide-number: true
    chalkboard: true
    preview-links: auto
    footer: <https://rstd.io/btt>
    margin: 0.07
    code-link: true
    code-line-numbers: false
execute:
  echo: true
  eval: false
bibliography: references.bib
---

# üåê Share your package

## Learning Objectives

At the end of this section you will be able to:

::: small

-   Add a `README.md` by building and populating a `README.Rmd` 

-   Set up a GitHub action that will run 
    -   run `R CMD check` on multiple OS on GitHub and
    -   add badge with the result to the README

-   Describe the additions made when adding a GitHub action

-   Add a package vignette

-   Use **`pkgdown`** [@pkgdown] to create a website for your package

-   Describe additions made when making and hosting a **`pkgdown`** website

:::

# Overview

## Overview

-   `README.md`: Often the first file read by the user. Include one!

. . .

-   Vignette: A long-form guide to your package. Can describe the problem that your package is designed to solve, and then show the reader how to solve it.

. . .

-   Package website

. . .

ü¶∏‚Äç‚ôÄÔ∏è **`usethis`** [@usethis]

# README

## `README.md`

Big picture goes in the README:

-   High-level purpose of the package
-   Simple example
-   Installation instructions
-   Description of main features with links to vignettes

## `README.Rmd`

You are likely to have code in the `README.md`

. . .

Generating it with R Markdown is helpful

## **`usethis`** helps out again!

. . .

`usethis::use_readme_rmd()` will:

-   generate a template `README.Rmd` which
    -   outputs a GitHub markdown doc
    -   contains reminders of things to include
    -   has tips

. . .

-   adds the `README.Rmd` to the `.Rbuildignore`
-   adds a "pre-commit" hook to ensure you knit to `md` before committing

## Add a `README.Rmd`

üé¨ Add a `README.Rmd` with:

```{r}
usethis::use_readme_rmd()
```

. . .

``` default
‚úî Writing 'README.Rmd'
‚úî Adding '^README\\.Rmd$' to '.Rbuildignore'
‚Ä¢ Modify 'README.Rmd'
‚úî Writing '.git/hooks/pre-commit'
```

## Template

üé¨ Examine your `README.Rmd`

. . .

-   GitHub markdown
-   reminder to edit `README.Rmd` rather than `README.md`
-   Sets up some recommended knitr options

## 

```{r}
#| echo: fenced
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

## Render

You need to render `README.Rmd` regularly, to keep `README.md` up-to-date.

`devtools::build_readme()` is handy for this.

. . .

üé¨ Render with `README.md`:

```{r}
devtools::build_readme()
```

. . .

``` default
‚Ñπ Installing ussie in temporary library
‚Ñπ Building C:/Users/er13/OneDrive - University of York/Desktop/Desktop/rstudio-conf-2022/ussie'/README.Rmd
```

## `devtools::build_readme()`

-   creates `README.md`
-   creates `man/figures/README-pressure-1.png`

## Edit `README.Rmd`

üé¨ Complete: "The goal of ussie is to ..."

\

üé¨ Add: an example with `uss_make_maches()`

¬†

üé¨ Remove: non-relevant sections

## An answer

Complete: "The goal of ussie is to ..."

``` default
The goal of ussie is to help you to work with European football league data supplied by the **`engsoccerdata`** package (Curley 2016).
```

. . .

Add: an example with `uss_make_maches()`

```{r example}
#| echo: fenced
library(ussie)
uss_make_matches(engsoccerdata::italy, "Italy")
```

. . .

Remove: non-relevant sections

Everything after "What is special about using......"

## Add a badge to the `README.Rmd`?

Badges give information to the user about the state of the package

. . .

For example: ![](https://github.com/3mmaRand/ussie/actions/workflows/R-CMD-check.yaml/badge.svg){width="300" height="39"}

. . .

To add this badge, we set up a "GitHub Action"

. . .

A GitHub Action is "continuous integration" which allows you to automate package building, testing and deployment on github

. . .

Actions we add are triggered when we push to GitHub.

## Adding a `R CMD check` action

Adding the `R CMD check` action along with an edit to the `README.Rmd` will:

-   run `R CMD check` on multiple OS on GitHub and

-   add badge with the result to the `README.Rmd`

. . .

We can add with `usethis::use_github_action_check_standard()`

## Adding a `R CMD check` action

üé¨ Add the `R CMD check` action:

```{r}
usethis::use_github_action_check_standard()
```

## 

::: small
``` default
‚úî Creating '.github/'
‚úî Adding '^\\.github$' to '.Rbuildignore'
‚úî Adding '*.html' to '.github/.gitignore'
‚úî Creating '.github/workflows/'
‚úî Saving 'r-lib/actions/examples/check-standard.yaml@v2' to '.github/workflows/R-CMD-check.yaml'
‚Ä¢ Learn more at <https://github.com/r-lib/actions/blob/v2/examples/README.md>.
‚úî Adding R-CMD-check badge to 'README.Rmd'
‚Ä¢ Re-knit 'README.Rmd' with `devtools::build_readme()`
```
:::

## What's changed?

üé¨ Look at your `README.Rmd`

::: small
``` default
<!-- badges: start -->
[![R-CMD-check](https://github.com/3mmaRand/ussie/actions/workflows/R-CMD-check.yaml/badge.svg)](https://github.com/3mmaRand/ussie/actions/workflows/R-CMD-check.yaml)

<!-- badges: end -->
```
:::

## Do as it said!

::: small
``` default
.......
‚Ä¢ Re-knit 'README.Rmd' with `devtools::build_readme()`
```
:::

üé¨ Re-knit `README.Rmd` with:

```{r}
devtools::build_readme()
```

## What else has changed?

`.github/workflows/R-CMD-check.yaml` is created

\

üé¨ Look at `.github/workflows/R-CMD-check.yaml`

## `R-CMD-check.yaml`

::: extrasmall
    # Workflow derived from https://github.com/r-lib/actions/tree/v2/examples
    # Need help debugging build failures? Start at https://github.com/r-lib/actions#where-to-find-help
    on:
      push:
        branches: [main, master]
      pull_request:
        branches: [main, master]

    name: R-CMD-check

    jobs:
      R-CMD-check:
        runs-on: ${{ matrix.config.os }}

        name: ${{ matrix.config.os }} (${{ matrix.config.r }})

        strategy:
          fail-fast: false
          matrix:
            config:
              - {os: macOS-latest,   r: 'release'}
              - {os: windows-latest, r: 'release'}
              - {os: ubuntu-latest,   r: 'devel', http-user-agent: 'release'}
              - {os: ubuntu-latest,   r: 'release'}
              - {os: ubuntu-latest,   r: 'oldrel-1'}

        env:
          GITHUB_PAT: ${{ secrets.GITHUB_TOKEN }}
          R_KEEP_PKG_SOURCE: yes

        steps:
          - uses: actions/checkout@v2

          - uses: r-lib/actions/setup-pandoc@v2

          - uses: r-lib/actions/setup-r@v2
            with:
              r-version: ${{ matrix.config.r }}
              http-user-agent: ${{ matrix.config.http-user-agent }}
              use-public-rspm: true

          - uses: r-lib/actions/setup-r-dependencies@v2
            with:
              extra-packages: any::rcmdcheck
              needs: check

          - uses: r-lib/actions/check-r-package@v2
            with:
              upload-snapshots: true
:::

## Commit and push

üé¨ Stage and commit

\

üé¨ Push to GitHub

## 

![](images/badge-check-no-status.png)

## 

![](images/badge-check-progress.png)

## 

![](images/badge-check-passing-status-01.png)

## Other GitHub Actions

-   Build and deploy a pkgdown site

-   Determine test coverage

We will use usethis helpers for GitHub Actions again.

# Vignettes

## Vignettes

-   A long-form guide to your package.
-   Function documentation is useful if you know the function name
-   A vignette explains how to use your package
-   Can describe the problem that your package is designed to solve, and then show the reader how to solve it.

## Add a vignette

üé¨ Add a vignette called "ussie" with

```{r}
usethis::use_vignette("ussie")
```

## What's happened?

::: small
``` default
‚úî Adding 'knitr' to Suggests field in DESCRIPTION
‚úî Setting VignetteBuilder field in DESCRIPTION to 'knitr'
‚úî Adding 'inst/doc' to '.gitignore'
‚úî Creating 'vignettes/'
‚úî Adding '*.html', '*.R' to 'vignettes/.gitignore'
‚úî Adding 'rmarkdown' to Suggests field in DESCRIPTION
‚úî Writing 'vignettes/ussie.Rmd'
‚Ä¢ Modify 'vignettes/ussie.Rmd'
```
:::

## Edit `vignettes/ussie.Rmd`

üé¨ Add info to `vignettes/ussie.Rmd`

## An answer

::: small
```{r setup}
#| echo: fenced
library(ussie)
library(dplyr)
```

The goal of **ussie** is to help you work with European Football League data. It uses data from the **engsoccerdata** package.

We can create a *matches* tibble using raw data from engsoccerdata:

```{r matches_italy}
#| echo: fenced
matches_italy <- uss_make_matches(engsoccerdata::italy, "Italy")
glimpse(matches_italy)
```
:::

## Preview the Vignette

üé¨ hit knit

üé¨

```{r}
devtools::build_rmd("vignettes/ussie.Rmd")
```

``` default
‚Ñπ Installing ussie in temporary library
‚Ñπ Building C:/Users/er13/Desktop/ussie/vignettes/ussie.Rmd
```

# pkgdown sites

## 

pkgdown is designed to make it quick and easy to build a website for your package

-   [palmerpenguins](https://allisonhorst.github.io/palmerpenguins/)

-   [ggplot2](https://ggplot2.tidyverse.org/)

Very widely used

## 

Uses your existing documentation

-   Home page - from `README.md`
-   Get started - from overall pkg vignette
-   Function Reference - from documentation in `man/`
-   Articles - from other vignettes

## Workflow

-   Configure package to use pkgdown with `usethis::use_pkgdown()` ONCE

-   build the website locally `pkgdown::build_site()`

## 

üé¨ config

```{r}
usethis::use_pkgdown() 
```

``` default
‚úî Adding '^_pkgdown\\.yml$', '^docs$', '^pkgdown$' to '.Rbuildignore'
‚úî Adding 'docs' to '.gitignore'
‚úî Writing '_pkgdown.yml'
‚Ä¢ Modify '_pkgdown.yml'
```

## `_pkgdown.yml`

Simple

``` default
url: ~
template:
  bootstrap: 5
```

Can be customised:

-   [ggplot2 `_pkgdown.yml`](https://github.com/tidyverse/ggplot2/blob/main/_pkgdown.yml)
-   [palmerpenguins `_pkgdown.yml`](https://github.com/allisonhorst/palmerpenguins/blob/master/_pkgdown.yml)

## 

üé¨ build

```{r}
pkgdown::build_site()
```

. . .

::: {.tenor-gif-embed data-postid="17163309" data-share-method="host" data-aspect-ratio="0.921875" data-width="50%"}
<a href="https://tenor.com/view/charlie-brown-snoopy-christmas-dance-dancing-gif-17163309">Charlie Brown Snoopy GIF</a>from <a href="https://tenor.com/search/charlie+brown-gifs">Charlie Brown GIFs</a>
:::

```{=html}
<script type="text/javascript" async src="https://tenor.com/embed.js"></script>
```
## 

::: extrasmall
    -- Installing package into temporary library -----------
    Warning: package ‚Äòussie‚Äô is in use and will not be installed
    == Building pkgdown site =======================================================
    Reading from: 'C:/Users/er13/OneDrive - University of York/Desktop/Desktop/rstudio-conf-2022/ussie'
    Writing to:   'C:/Users/er13/OneDrive - University of York/Desktop/Desktop/rstudio-conf-2022/ussie/docs'
    -- Initialising site -----------------------------------------------------------
    Copying '../../../../Program Files/R/R-4.2.0/library/pkgdown/BS5/assets/link.svg' to 'link.svg'
    Copying '../../../../Program Files/R/R-4.2.0/library/pkgdown/BS5/assets/pkgdown.js' to 'pkgdown.js'
    -- Building home ---------------------------------------------------------------
    Writing 'authors.html'
    Reading 'LICENSE.md'
    Writing 'LICENSE.html'
    Writing 'LICENSE-text.html'
    Copying 'man/figures/README-pressure-1.png' to 'reference/figures/README-pressure-1.png'
    Writing '404.html'
    -- Building function reference -------------------------------------------------
    Writing 'reference/index.html'
    Reading 'man/ussie-package.Rd'
    Writing 'reference/ussie-package.html'
    Reading 'man/uss_make_matches.Rd'
    Writing 'reference/uss_make_matches.html'
    -- Building articles -----------------------------------------------------------
    Writing 'articles/index.html'
    Reading 'vignettes/ussie.Rmd'
    Writing 'articles/ussie.html'
    Writing 'sitemap.xml'
    -- Building search index -------------------------------------------------------
    == DONE ========================================================================
    -- Previewing site -------------------------------------
:::

## 

-   `docs/` is created
-   
-   

## Hosting on Github

Set up GitHub Actions to automatically build and publish your site

Let github build the page rather than building and hosting results `usethis::use_pkgdown_github_pages()`

üé¨ action

```{r}
usethis::use_pkgdown_github_pages()
```

## 

``` default
Overwrite pre-existing file '_pkgdown.yml'?

1: Yup
2: Nope
3: Negative
```

üé¨ Chose the option that means Yes

## 

::: small
``` default
‚úî Writing '_pkgdown.yml'
‚Ä¢ Modify '_pkgdown.yml'
‚úî Initializing empty, orphan 'gh-pages' branch in GitHub repo '3mmaRand/ussie'
‚úî GitHub Pages is publishing from:
‚Ä¢ URL: 'https://3mmarand.github.io/ussie/'
‚Ä¢ Branch: 'gh-pages'
‚Ä¢ Path: '/'
‚úî Saving 'r-lib/actions/examples/pkgdown.yaml@v2' to '.github/workflows/pkgdown.yaml'
‚Ä¢ Learn more at <https://github.com/r-lib/actions/blob/v2/examples/README.md>.
‚úî Recording 'https://3mmarand.github.io/ussie/' as site's url in '_pkgdown.yml'
‚úî Adding 'https://3mmarand.github.io/ussie/' to URL field in DESCRIPTION
‚Ä¢ Run `devtools::document()` to update package-level documentation.
‚úî Setting 'https://3mmarand.github.io/ussie/' as homepage of GitHub repo '3mmaRand/ussie'
```
:::

## 

## `_pkgdown.yml`

Simple

``` default
url: https://3mmarand.github.io/ussie/
template:
  bootstrap: 5
```

## What else has changed?

`.github/workflows/pkgdown.yaml` is created

\

üé¨ Look at `.github/workflows/pkgdown.yaml`

## `pkgdown.yaml`

::: extrasmall
    # Workflow derived from https://github.com/r-lib/actions/tree/v2/examples
    # Need help debugging build failures? Start at https://github.com/r-lib/actions#where-to-find-help
    on:
      push:
        branches: [main, master]
      pull_request:
        branches: [main, master]
      release:
        types: [published]
      workflow_dispatch:

    name: pkgdown

    jobs:
      pkgdown:
        runs-on: ubuntu-latest
        # Only restrict concurrency for non-PR jobs
        concurrency:
          group: pkgdown-${{ github.event_name != 'pull_request' || github.run_id }}
        env:
          GITHUB_PAT: ${{ secrets.GITHUB_TOKEN }}
        steps:
          - uses: actions/checkout@v2

          - uses: r-lib/actions/setup-pandoc@v2

          - uses: r-lib/actions/setup-r@v2
            with:
              use-public-rspm: true

          - uses: r-lib/actions/setup-r-dependencies@v2
            with:
              extra-packages: any::pkgdown, local::.
              needs: website

          - name: Build site
            run: pkgdown::build_site_github_pages(new_process = FALSE, install = FALSE)
            shell: Rscript {0}

          - name: Deploy to GitHub pages üöÄ
            if: github.event_name != 'pull_request'
            uses: JamesIves/github-pages-deploy-action@4.1.4
            with:
              clean: false
              branch: gh-pages
              folder: docs
:::

## Commit and push

üé¨ Stage and commit

\

üé¨ Push to GitHub

## 

# üåê Woo hoo üåê <BR> You have shared your package!

## Summary

::: small
-   Always include a `README.md` with the purpose of the package, installation instructions and a simple example
-   `usethis::use_readme_rmd()` will generate a template `README.Rmd` and do other useful things
-   `devtools::build_readme()` will build `README.md` from `README.Rmd`
-   A GitHub Actions is a ‚Äúcontinuous integration‚Äù tool which allows you to automate package building, testing and deployment on GitHub
-  `usethis::use_github_action_check_standard()` will add the `R CMD check` action and a badge




:::

## Summary

::: small
-   A vignette gives a more detailed explanation of how your package can be used
-   You can add a vignette with `usethis::use_vignette(name_of_vignette)`
-   **`pkgdown`** makes it quick and easy to build a website for your package from the existing documentation
-   `usethis::use_pkgdown()` configures your package to use a **`pkgdown`** website
-   `pkgdown::build_site()` will build the wqebsite so you can examine it locally
-   `usethis::use_pkgdown_github_pages()` sets up a GitHub action to automatically build and publish your site on pushing.
-   **`usethis`** really rocks!

:::

## References {.extrasmall}
